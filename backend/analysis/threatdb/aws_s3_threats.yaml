# AWS S3 Threats
# Threat definitions for Amazon S3 buckets

threats:
  - id: AWS-S3-001
    name: S3 Bucket Publicly Accessible
    description: |
      S3 bucket is configured with public read or write access through ACLs.
      This exposes sensitive data to unauthorized access from the internet
      and could lead to data breaches or unauthorized modifications.
    severity: critical
    likelihood: likely
    category: Data Exposure
    resource_types:
      - aws_s3_bucket
    cloud_providers:
      - aws
    conditions:
      logic: or
      conditions:
        - field: properties.acl
          operator: "=="
          value: "public-read"
        - field: properties.acl
          operator: "=="
          value: "public-read-write"
    attack_vectors:
      - Direct data exfiltration via HTTP
      - Search engine indexing of sensitive files
      - Malicious file uploads to public buckets
      - Cryptojacking by uploading mining scripts
    exploitability: high
    business_impact: critical
    mitigations:
      - description: Remove public ACL
        effort: low
        impact: high
        steps:
          - Change ACL to "private"
          - Use bucket policies for granular access control
          - Enable S3 Block Public Access settings
          - Audit existing public buckets regularly
      - description: Implement bucket policies
        effort: medium
        impact: high
        steps:
          - Create restrictive bucket policies
          - Use IAM roles instead of public access
          - Enable MFA delete for sensitive buckets
    references:
      - https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html
      - https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html
    compliance_mappings:
      - framework: CIS
        control_id: "2.1.5"
        description: Ensure that S3 Buckets are configured with Block public access
      - framework: GDPR
        control_id: "Article 32"
        description: Security of processing
      - framework: NIST
        control_id: AC-3
        description: Access Enforcement
    tags:
      - public-access
      - s3
      - data-breach

  - id: AWS-S3-002
    name: S3 Bucket Versioning Not Enabled
    description: |
      S3 bucket does not have versioning enabled. This increases risk of
      permanent data loss from accidental deletions or overwrites, and
      reduces ability to recover from ransomware attacks.
    severity: medium
    likelihood: possible
    category: Data Loss
    resource_types:
      - aws_s3_bucket_versioning
    cloud_providers:
      - aws
    conditions:
      logic: or
      conditions:
        - field: properties.versioning_configuration.status
          operator: "=="
          value: "Disabled"
        - field: properties.versioning_configuration.status
          operator: "=="
          value: "Suspended"
    attack_vectors:
      - Ransomware encryption without recovery option
      - Accidental file deletion
      - Malicious overwriting of files
    exploitability: medium
    business_impact: high
    mitigations:
      - description: Enable S3 versioning
        effort: low
        impact: high
        steps:
          - Set versioning status to "Enabled"
          - Configure lifecycle policies to manage old versions
          - Enable MFA Delete for additional protection
          - Document version retention policy
    references:
      - https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html
    compliance_mappings:
      - framework: CIS
        control_id: "2.1.3"
        description: Ensure MFA Delete is enabled on S3 buckets
    tags:
      - versioning
      - data-protection
      - ransomware-protection

  - id: AWS-S3-003
    name: S3 Bucket Encryption Not Enabled
    description: |
      S3 bucket does not have default encryption enabled. Data stored in
      the bucket is not encrypted at rest, violating compliance requirements
      and increasing risk of data exposure.
    severity: high
    likelihood: certain
    category: Data Exposure
    resource_types:
      - aws_s3_bucket
    cloud_providers:
      - aws
    conditions:
      logic: and
      conditions:
        - field: properties.server_side_encryption_configuration
          operator: not_exists
          value: null
    attack_vectors:
      - Physical theft of storage devices
      - Unauthorized AWS account access
      - Insider threats with infrastructure access
    exploitability: low
    business_impact: high
    mitigations:
      - description: Enable default bucket encryption
        effort: low
        impact: high
        steps:
          - Configure server_side_encryption_configuration
          - Use AES256 or aws:kms encryption
          - Enable bucket key for KMS cost optimization
          - Enforce encryption with bucket policy
    references:
      - https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucket-encryption.html
    compliance_mappings:
      - framework: PCI DSS
        control_id: "3.4"
        description: Render PAN unreadable anywhere it is stored
      - framework: HIPAA
        control_id: "164.312(a)(2)(iv)"
        description: Encryption and Decryption
    tags:
      - encryption
      - data-at-rest
      - compliance

  - id: AWS-S3-004
    name: S3 Public Access Block Not Configured
    description: |
      S3 bucket does not have public access block settings configured.
      The bucket public access block provides account-level and bucket-level
      controls to ensure S3 buckets don't allow public access.
    severity: high
    likelihood: likely
    category: Data Exposure
    resource_types:
      - aws_s3_bucket_public_access_block
    cloud_providers:
      - aws
    conditions:
      logic: or
      conditions:
        - field: properties.block_public_acls
          operator: "=="
          value: false
        - field: properties.block_public_policy
          operator: "=="
          value: false
        - field: properties.ignore_public_acls
          operator: "=="
          value: false
        - field: properties.restrict_public_buckets
          operator: "=="
          value: false
    attack_vectors:
      - Accidental bucket policy changes allowing public access
      - Misconfigured ACLs exposing data
      - Social engineering to manipulate bucket settings
    exploitability: high
    business_impact: critical
    mitigations:
      - description: Enable all public access block settings
        effort: low
        impact: high
        steps:
          - Set block_public_acls to true
          - Set block_public_policy to true
          - Set ignore_public_acls to true
          - Set restrict_public_buckets to true
          - Apply settings at account level for all buckets
    references:
      - https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html
    compliance_mappings:
      - framework: CIS
        control_id: "2.1.5"
        description: Ensure that S3 Buckets are configured with Block public access
    tags:
      - public-access-block
      - preventive-control
